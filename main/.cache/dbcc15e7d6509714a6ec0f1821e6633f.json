{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","loc":{"line":3,"column":37}},{"name":"lodash/isFunction","loc":{"line":11,"column":50}},{"name":"tslib","loc":{"line":13,"column":21}},{"name":"import-html-entry","loc":{"line":15,"column":31}},{"name":"single-spa","loc":{"line":17,"column":25}}],"generated":{"js":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.prefetchImmediately = prefetchImmediately;\nexports.doPrefetchStrategy = doPrefetchStrategy;\n\nvar _isFunction2 = _interopRequireDefault(require(\"lodash/isFunction\"));\n\nvar _tslib = require(\"tslib\");\n\nvar _importHtmlEntry = require(\"import-html-entry\");\n\nvar _singleSpa = require(\"single-spa\");\n\n/**\n * @author Kuitos\n * @since 2019-02-26\n */\n// RIC and shim for browsers setTimeout() without it\nvar requestIdleCallback = window.requestIdleCallback || function requestIdleCallback(cb) {\n  var start = Date.now();\n  return setTimeout(function () {\n    cb({\n      didTimeout: false,\n      timeRemaining: function timeRemaining() {\n        return Math.max(0, 50 - (Date.now() - start));\n      }\n    });\n  }, 1);\n}; // https://stackoverflow.com/questions/3514784/what-is-the-best-way-to-detect-a-mobile-device\n\n\nvar isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\nvar isSlowNetwork = navigator.connection ? navigator.connection.saveData || /(2|3)g/.test(navigator.connection.effectiveType) : false;\n/**\n * prefetch assets, do nothing while in mobile network\n * @param entry\n * @param opts\n */\n\nfunction prefetch(entry, opts) {\n  var _this = this;\n\n  if (isMobile || isSlowNetwork) {\n    // Don't prefetch if an mobile device or in a slow network.\n    return;\n  }\n\n  requestIdleCallback(function () {\n    return (0, _tslib.__awaiter)(_this, void 0, void 0, function () {\n      var _a, getExternalScripts, getExternalStyleSheets;\n\n      return (0, _tslib.__generator)(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , (0, _importHtmlEntry.importEntry)(entry, opts)];\n\n          case 1:\n            _a = _b.sent(), getExternalScripts = _a.getExternalScripts, getExternalStyleSheets = _a.getExternalStyleSheets;\n            requestIdleCallback(getExternalStyleSheets);\n            requestIdleCallback(getExternalScripts);\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  });\n}\n\nfunction prefetchAfterFirstMounted(apps, opts) {\n  window.addEventListener('single-spa:first-mount', function listener() {\n    var mountedApps = (0, _singleSpa.getMountedApps)();\n    var notMountedApps = apps.filter(function (app) {\n      return mountedApps.indexOf(app.name) === -1;\n    });\n\n    if (undefined === 'development') {\n      console.log(\"[qiankun] prefetch starting after \" + mountedApps + \" mounted...\", notMountedApps);\n    }\n\n    notMountedApps.forEach(function (_a) {\n      var entry = _a.entry;\n      return prefetch(entry, opts);\n    });\n    window.removeEventListener('single-spa:first-mount', listener);\n  });\n}\n\nfunction prefetchImmediately(apps, opts) {\n  if (undefined === 'development') {\n    console.log('[qiankun] prefetch starting for apps...', apps);\n  }\n\n  apps.forEach(function (_a) {\n    var entry = _a.entry;\n    return prefetch(entry, opts);\n  });\n}\n\nfunction doPrefetchStrategy(apps, prefetchStrategy, importEntryOpts) {\n  var _this = this;\n\n  var appsName2Apps = function appsName2Apps(names) {\n    return apps.filter(function (app) {\n      return names.includes(app.name);\n    });\n  };\n\n  if (Array.isArray(prefetchStrategy)) {\n    prefetchAfterFirstMounted(appsName2Apps(prefetchStrategy), importEntryOpts);\n  } else if ((0, _isFunction2.default)(prefetchStrategy)) {\n    (function () {\n      return (0, _tslib.__awaiter)(_this, void 0, void 0, function () {\n        var _a, _b, criticalAppNames, _c, minorAppsName;\n\n        return (0, _tslib.__generator)(this, function (_d) {\n          switch (_d.label) {\n            case 0:\n              return [4\n              /*yield*/\n              , prefetchStrategy(apps)];\n\n            case 1:\n              _a = _d.sent(), _b = _a.criticalAppNames, criticalAppNames = _b === void 0 ? [] : _b, _c = _a.minorAppsName, minorAppsName = _c === void 0 ? [] : _c;\n              prefetchImmediately(appsName2Apps(criticalAppNames), importEntryOpts);\n              prefetchAfterFirstMounted(appsName2Apps(minorAppsName), importEntryOpts);\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    })();\n  } else {\n    switch (prefetchStrategy) {\n      case true:\n        prefetchAfterFirstMounted(apps, importEntryOpts);\n        break;\n\n      case 'all':\n        prefetchImmediately(apps, importEntryOpts);\n        break;\n\n      default:\n        break;\n    }\n  }\n}"},"hash":"237ee842f951acf3bf04d6ed509aa757"}